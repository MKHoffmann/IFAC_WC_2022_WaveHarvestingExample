\section{Model and Problem Statement}

\begin{figure}[htb]
	\centering
	\fontsize{9}{0}\selectfont
	\def\svgwidth{0.5\textwidth}
	\input{images/flap.pdf_tex}
	\caption{Wave surge converter: A flap mounted to the sea floor is tilted by the wave motion. It is displayed in a generic (left) and the vertical equilibrium position (right).}%Pitching flap WEC with parallelogram DEG: generic position (left); and vertical equilibrium position (right)}
\label{fig:flap}
\end{figure}

\subsection{Background}
\ac{mpc} arose from optimal control as one answer on how to \qm{close the loop} (\cite{rawlings2017mpc}).\ 
In optimal control, a system's behaviour is predicted for a time called the prediction horizon \tf into the future, while optimising the inputs to the system, such that a cost function is minimised.\
The working principle of \ac{mpc} is repeatedly measuring the system's state, solving an \ac{ocp}, and applying the first few of the calculated inputs.\

\textit{Notation:} The subindex $\mathrm{MPC}$ marks applied inputs and resulting states of the actual system.

\subsection{System}
In this work, we investigate the \ac{mpc} of the wave surge converter (see, e.g. \cite{Whittaker2012}), displayed in \figref{fig:flap}.\
The device is pivoted to the sea, such that incoming waves excite an oscillatory motion.\ 
This distorts a \ac{deg} mounted to a deformable parallelogram, \cite{Moretti2014}.\ 
Through this parallelogram, the \ac{deg} applies a torque to the flap towards the equilibrium position $\theta=0$.\ 
Applying a voltage to the \ac{deg} adds an electrostatically-induced torque in the same angular direction, making the system stiffer.\ 

When a voltage is applied to the \ac{deg}, charge carriers accumulate in the \ac{deg}.\ 
By deforming the parallelogram to a smaller area (increased $\theta$), the charge density increases, such that energy can be extracted.\  
As we showed in our previous work \cite{Hoffmann2022moocp_wcdeg}, controlling the input to maximise the energy extracted from the system requires application of large voltages, damaging the \ac{deg}-material over time, and resulting in system failure after too much damage accumulated \cite{Chen2019}.\
For that reason, we also took the damage into consideration as a second control goal, resulting in lower electric fields in the \ac{deg}.

\subsection{Model}
The dynamics of the wave surge 
\begin{equation}\label{eq:dynamics}
	\begin{split}
		\begin{bmatrix}
			\dot{\theta} \\
			\dot{\delta}  \\
			\dot{z}
		\end{bmatrix}
		& = \begin{bmatrix}
			0 & 1 & 0^{1\times n} \\
			-I_h^{-1}K_\mathrm{h} & -I_\mathrm{h}^{-1}B_\mathrm{h} & -I_\mathrm{h}^{-1}C_\mathrm{r} \\[3pt]
			0^{n\times 1} & B_\mathrm{r} & A_\mathrm{r}
		\end{bmatrix}    \begin{bmatrix}
			{\theta} \\
			{\delta}  \\
			{z}
		\end{bmatrix} +  \\ &  + \begin{bmatrix}
			0 \\
			I_\mathrm{h}^{-1}  \\
			0^{n\times 1}
		\end{bmatrix} \left(d - C_0\theta u \right)\\
		\theta(0) &= \theta_0,\ \delta(0) = \delta_0,\ z(0) = z_0, 
	\end{split}
\end{equation}
contain the equation of angular motion and the wave loads generated by the interaction of the waves with the flap.\ 
Here, $\delta = \dot{\theta}$ describes the flap's angular velocity, $z \in \mathbb{R}^n$ the $n$-dimensional state vector for wave radiation (\cite{Yu1995}) and $d$, the force the waves exert on the flap.\
The input $u$ is the electrostatic force generated by the \ac{deg} when a voltage $v$ is applied.\ 
Since the \ac{deg}'s electrostatic force is proportional to the $v^2$, $u$ is restricted to be positive.
\todo{add u constraint explanation?}

\begin{equation}\label{eq:constr}
	u \le (\Ebd \hl)^2 / \cos^{2}(\theta),
\end{equation}

\subsection{Cost functions}
Our aim is the simultaneous minimisation of damage and maximisation of extracted energy, which we will employ in a \ac{moocp} setting.\ 
The extracted energy cost function is modelled as the negative generated energy
\begin{equation}\label{eq:J1}
	\begin{split}
		& J_1 = \Psi(\tf)-\Psi(0) +\int_0^{\tf} \left(B_\mathrm{h}\delta^2 +z^\intercal S_\mathrm{r} z +\dfrac{u}{R_0} - d \delta\right) \text{d}t \\
		& \text{with}\ \Psi = \dfrac{1}{2}I_\mathrm{h}\delta^2+\dfrac{1}{2}K_\mathrm{h}{\theta}^2+ \dfrac{1}{2}z^\intercal Q_\mathrm{r} z + \dfrac{1}{2} C_0\left(1 - \theta^2 \right) u,
	\end{split}
\end{equation}
with the storage function $\Psi$ including kinematic, potential, electrostatic, and hydrodynamic energy contributions.\ 
Dissipations due to viscous, hydrodynamic, and electrical losses, and the power input by the incident wave are considered via the integral terms.\ 

Under the assumption, that damage only starts accumulating after the applied electric field exceeds a threshold $\Eth$, the cost function can be formulated as
\begin{equation}\label{eq:J2}
	J_2 = \alpha \int_0^{\tf} \left(\max \{ \cos^2(\theta)u-\Eth^2 {\hl}^2,0 \} \right)^{\nd} \text{d}t, 
\end{equation}
with a normalisation factor $\alpha$ rendering $J_2$ dimensionless, and an experimental parameter \nd, that for our simulations will be set to 1.\ 
\todo{too close to Mathmod paper?}\ 

Equations \eqref{eq:dynamics}, \eqref{eq:constr}, \eqref{eq:J1}, and \eqref{eq:J2} formulate the \ac{moocp}

\begin{problem}\label{prob:ocp}
	\begin{align}\label{eq:problem}
	\minimize_{u(t)} \ \ \, &(J_1, J_2) \nonumber\\
	\ \st \ &\text{dynamics}\ \eqref{eq:dynamics} \nonumber\\
	&0 \le \cos^2(\theta) u \le (\Ebd \hl)^2.
\end{align}
\end{problem}
that is solved inside the \ac{mpc}.